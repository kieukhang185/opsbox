minimum_pre_commit_version: "3.6.0"

default_language_version:
  python: python3.12

repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-merge-conflict
      - id: check-json

  - repo: https://github.com/psf/black
    rev: 24.8.0
    hooks:
      - id: black
        files: ^(api/|worker/|tests)/

  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        files: ^(api/|worker/|tests)/

  - repo: https://github.com/pycqa/flake8
    rev: 7.1.1
    hooks:
      - id: flake8
        files: ^(api/|tests)/
        additional_dependencies:
          - flake8-bugbear==24.8.19
          - flake8-comprehensions==3.15.0
        args: [--config, .flake8]

  # Python: Ruff (linter+formatter+import sorter)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.13.3
    hooks:
      - id: ruff-check
        name: ruff (focused rules)
        files: ^(api/|worker/|tests)/
        args:
          - --select=F,E,I,UP,PERF  # example narrow set; tune to avoid overlap
          - --ignore=E501

  # Type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.10.0
    hooks:
      - id: mypy
        files: ^(api/|worker/|tests)/

  # Shell
  - repo: https://github.com/koalaman/shellcheck-precommit
    rev: v0.11.0
    hooks:
      - id: shellcheck
        files: ^scripts/shell-scripts/.*\.sh$
        args: [--severity=warning, --external-sources]

  # Dockerfiles
  - repo: https://github.com/AleksaC/hadolint-py
    rev: v2.12.1b3
    hooks:
      - id: hadolint
        args: [--ignore, DL3008, --ignore, DL3007, --ignore, DL4006]
        exclude: ^alembic/

  # YAML
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        args: [-c, .config.yaml]

  # Frontend
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.1.0
    hooks:
      - id: prettier
        files: ^web/.*\.(ts|tsx|js|jsx|json|css|md|yml|yaml)$
        language_version: system

  - repo: local
    hooks:
      # check ruff locally to auto-fix issues
      - id: check-ruff-local
        name: Check ruff
        entry: bash -c "ruff check . --fix"
        language: system
        files: \.py$

exclude: |
  (?x)^(
    ops/helm/|
    .*migrations/|
    \.venv/|
    venv/|
    node_modules/|
    dist/|
    build/
  )
